repeat task.wait() until game:IsLoaded() and game.Players.LocalPlayer
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VirtualUser = game:GetService("VirtualUser")
local CoreGui = game:GetService("CoreGui")

-- N·∫øu ch∆∞a set th√¨ g√°n m·∫∑c ƒë·ªãnh
getgenv().Race = getgenv().Race or "Thi√™n Th·∫ßn"
getgenv().Mode = getgenv().Mode or "Melee"

-- ‚úÖ Auto b·∫≠t PvP khi v√†o game
task.spawn(function()
    while task.wait(5) do
        pcall(function()
            if LocalPlayer.PlayerGui.Main.PvpButton.Size ~= UDim2.new(0,0,0,0) then
                -- Gi·∫£ l·∫≠p click v√†o n√∫t PvP
                game:GetService("VirtualInputManager"):SendMouseButtonEvent(0,0,0,true,game,0)
                game:GetService("VirtualInputManager"):SendMouseButtonEvent(0,0,0,false,game,0)
            end
        end)
    end
end)

-- H√†m l·∫•y Race
local function getRace(player)
    local success, race = pcall(function()
        return player.Data.Race.Value
    end)
    return success and race or "Unknown"
end

-- Teleport ƒë·∫øn target
local function tpToTarget(target)
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
       and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame =
            target.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,5)
    end
end

-- Attack modes
local function attack(mode)
    if mode == "Melee" then
        VirtualUser:CaptureController()
        VirtualUser:Button1Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        task.wait(0.1)
        VirtualUser:Button1Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)

    elseif mode == "Sword" then
        game:GetService("VirtualInputManager"):SendKeyEvent(true, "Z", false, game)
        task.wait(0.2)
        game:GetService("VirtualInputManager"):SendKeyEvent(false, "Z", false, game)

    elseif mode == "Fruit" then
        game:GetService("VirtualInputManager"):SendKeyEvent(true, "X", false, game)
        task.wait(0.2)
        game:GetService("VirtualInputManager"):SendKeyEvent(false, "X", false, game)
    end
end

-- PvP loop
local PvP_Enabled = false
local function huntRace()
    if not getgenv().Race then
        warn("‚ö†Ô∏è B·∫°n ch∆∞a set getgenv().Race tr∆∞·ªõc khi load script!")
        return
    end
    local mode = getgenv().Mode or "Melee"

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local race = getRace(plr)
            if race == getgenv().Race then
                print("üéØ PvP v·ªõi " .. plr.Name .. " (Race: " .. race .. ") b·∫±ng ch·∫ø ƒë·ªô: " .. mode)
                while PvP_Enabled and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") do
                    tpToTarget(plr)
                    attack(mode)
                    task.wait(0.5)
                end
            end
        end
    end
end

-- Auto loop
task.spawn(function()
    while task.wait(2) do
        if PvP_Enabled then
            huntRace()
        end
    end
end)

-- ‚úÖ GUI Toggle
if CoreGui:FindFirstChild("RaceHuntGui") then
    CoreGui.RaceHuntGui:Destroy()
end

local ScreenGui = Instance.new("ScreenGui", CoreGui)
ScreenGui.Name = "RaceHuntGui"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 220, 0, 140)
Frame.Position = UDim2.new(0.7, 0, 0.2, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,30)
Title.Text = "Race PvP Hunter"
Title.BackgroundColor3 = Color3.fromRGB(40,40,40)
Title.TextColor3 = Color3.fromRGB(255,255,255)

local ToggleBtn = Instance.new("TextButton", Frame)
ToggleBtn.Size = UDim2.new(0, 180, 0, 40)
ToggleBtn.Position = UDim2.new(0.5, -90, 0.3, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0,150,255)
ToggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
ToggleBtn.Text = "B·∫≠t PvP Hunt"

local Info = Instance.new("TextLabel", Frame)
Info.Size = UDim2.new(1, -10, 0, 30)
Info.Position = UDim2.new(0,5,0.75,0)
Info.BackgroundTransparency = 1
Info.Text = "Race: "..getgenv().Race.." | Mode: "..getgenv().Mode
Info.TextColor3 = Color3.fromRGB(200,200,200)
Info.TextScaled = true

ToggleBtn.MouseButton1Click:Connect(function()
    PvP_Enabled = not PvP_Enabled
    if PvP_Enabled then
        ToggleBtn.Text = "T·∫Øt PvP Hunt"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0,255,100)
    else
        ToggleBtn.Text = "B·∫≠t PvP Hunt"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0,150,255)
    end
end)
